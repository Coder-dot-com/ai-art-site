<div id="user_payment_form">

  <a 
  href=""
  class="light small"
  hx-get="{% url 'shipping_form_and_options' order.order_number %}"
  hx-trigger="click"
  hx-target="#user_payment_form"
  hx-encoding="multipart/form-data"
  hx-swap="outerHTML">


  < Previous</a>

<div class="mb-3">

  <b>Your order details</b>
  <br>
  Email: {{order.email.email}}
  

  <br><br>
  Order items

  {% for key,order_product in order.get_order_products.items %}
  
  {{order_product.product.type_of_purchase}} <br>
  {% if order_product.product.orientation %}
  {{order_product.product.orientation}} <br>
  {% endif %}
  
  {% if order_product.product.price %}
  {{order_product.product.price}} <br>
  {% endif %}

  
  {% endfor %}
  


</div>
<form id="payment-form">
    <div id="payment-element">
      <!-- Elements will create form elements here -->
    </div>
    <br>
    {% comment %} <a  class="light small"  
    hx-get="{% url 'user_payment_form' page.url_slug %}" 
    hx-trigger="click once"
    hx-target="#user_payment_form"
    hx-encoding="multipart/form-data"        
    hx-swap="outerHTML">
    
    
    < Go back</a> {% endcomment %}

    <button class="btn site-button btn-primary" style="float:right;" id="submit">Extend now</button>
    <div id="error-message">
      <!-- Display error message to your customers here -->
    </div>
  </form>
  

<script>
    var stripe = Stripe('{{stripe_pub_key}}');
    
    var stripeOptions = {
      clientSecret: '{{client_secret}}',
      // Fully customizable with appearance API.
      appearance: {/*...*/},
    };
    
    // Set up Stripe.js and Elements to use in checkout form, passing the client secret obtained in step 2
    var elements = stripe.elements(stripeOptions);
    
    // Create and mount the Payment Element
    var paymentElement = elements.create('payment');
    paymentElement.mount('#payment-element');
    
    
    var form = document.getElementById('payment-form');
    
    form.addEventListener('submit', async (event) => {
      event.preventDefault();
    
      var {error} = await stripe.confirmPayment({
        //`Elements` instance that was used to create the Payment Element
        elements,
        confirmParams: {
          return_url: '{{return_url}}',
        },
      });
    
      if (error) {
        // This point will only be reached if there is an immediate error when
        // confirming the payment. Show error to your customer (e.g., payment
        // details incomplete)
        var messageContainer = document.querySelector('#error-message');
        messageContainer.textContent = error.message;
      } else {
        // Your customer will be redirected to your `return_url`. For some payment
        // methods like iDEAL, your customer will be redirected to an intermediate
        // site first to authorize the payment, then redirected to the `return_url`.
      }
    });
    
    </script>

  </div>
